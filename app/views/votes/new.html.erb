<h1 class="mb-4">複数日投票</h1>

<div class="calendar-switch mb-3 text-center">
  <%= link_to "週表示", new_group_vote_path(@group, view: "week"), class: "btn btn-outline-primary btn-sm mx-1" %>
  <%= link_to "月表示", new_group_vote_path(@group, view: "month"), class: "btn btn-outline-secondary btn-sm mx-1" %>
</div>

<%= form_with url: group_votes_path(@group), method: :post, local: true do %>

  <!-- 新規ユーザー入力 -->
  <div class="form-group">
    <%= label_tag :user_name, "新規ユーザー名", class: "font-weight-bold" %>
    <%= text_field_tag :user_name, nil, class: "form-control" %>
  </div>

  <!-- 既存ユーザー選択 -->
  <div class="form-group">
    <p class="font-weight-bold">既存ユーザーを選択</p>
    <div class="border rounded p-2">
      <% @group.users.each do |user| %>
        <div class="form-check">
          <%= check_box_tag "existing_user_ids[]", user.id, false, class: "form-check-input", id: "user_#{user.id}" %>
          <%= label_tag "user_#{user.id}", user.name, class: "form-check-label" %>
        </div>
      <% end %>
    </div>
  </div>

  <hr>

  <!-- 日程候補部分 -->
  <div class="form-group">
    <p class="font-weight-bold">日程候補</p>

    <% calendar_method = @calendar_type == "month" ? :month_calendar : :week_calendar %>

    <div class="d-flex flex-column align-items-stretch">
      <%= send(calendar_method) do |date| %>
        <div class="border rounded p-3 mb-2">
          <div class="d-flex justify-content-between align-items-center">

            <div>
              <label class="mx-1">
                <%= radio_button_tag "days[#{date}]", "◯" %> ○
              </label>
              <label class="mx-1">
                <%= radio_button_tag "days[#{date}]", "△" %> △
              </label>
              <label class="mx-1">
                <%= radio_button_tag "days[#{date}]", "✕" %> ✕
              </label>
            </div>
          </div>
        </div>
      <% end %>
    </div>
  </div>

  <div class="text-center mt-4">
    <%= submit_tag "投票する", class: "btn btn-success btn-lg px-5" %>
  </div>

<% end %>

<div class="text-center mt-3">
  <%= link_to "投票一覧に戻る", group_votes_path(@group.id), class: "btn btn-link" %>
</div>
